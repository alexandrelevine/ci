# Набор скриптов для автоматического поднятия стенда

Данный набор скриптов предназначен для автоматического поднятия стенда, максимально похожего на используемый для продуктового решения.
Скрипты предназначены для поднятия стенда на KVM хосте. Минимальные требования: 20 ядер, 40Гб свободной памяти, 200Гб дискового пространства.
Для сетевого решения используется схема DVR HA. Версия 
Стенд состоит из машин:
  - один контроллер. Все сервисы контроллеров OpenStack: ntp, rabbitmq-server, percona-cluster, openstack-dashboard, glance, keystone, nova-cloud-controller, neutron-api + neutron-dynamic-routing-plugin, dynamic-routing-agent.
  - два гипервизора. Сервисы nova-compute, openvswitch.
  - три нетворк ноды. Сервисы l3-agent компонента neutron, openvswitch, neutron-router-helper.
  - одна нода эмулирующая внешний роутер. Из сервисов только bird.

## Подготовка KVM хоста
На хосте должен быть устанвлен пакет для работы Juju (https://jujucharms.com/docs/stable/reference-install)
  ```
  sudo add-apt-repository -yu ppa:juju/stable
  sudo apt install juju
  ```
Хост должен быть подготовлен для выполения команд утилиты virsh, для того пользователя (USER в блоке ниже), под логином которого, будут выполняться скрипты:
  ```
  sudo apt-get install -y git qemu-kvm iptables-persistent ufw virtinst uuid-runtime qemu libvirt-bin
  sudo usermod -aG libvirtd USER
  ```
Хост может быть установлен с помощью любого дистрибутива Linux, где возможна работа KVM и Juju. (Для проверки был использован хост с Ubuntu 17.04)
Для всех машин стенда используется образ ubuntu 16.04. Набор команд, который подготавливает нужный образ, расположен в файле juju/prepare-image.sh. Достаточно один раз выполнить эти команды и в дальнейшем, скрипты поднятия стенда будут всегда использовать этот образю
Так же, на хосте, в домашней директории пользователя, должны лежать архивы neutron-dynamic-routing.tgz и neutron-router-helper.tgz, внутри которых должны быть каталоги neutron-dynamic-routing и neutron-router-helper-master соответственно. Эти архивы будут использованы в процессе настройки стенда, для обеспечения совместимости с продуктовым решением.

## Подготовка/удаление виртуального окружения для стенда
Подготовка виртуального окружения (машины, сеть, ...) достигается вызовом скрипта create_env.sh
